Name:           {{ blueprint['name'] }}-{{ module_name }}
Version:        1.0
Release:        {{ ansible_facts['date_time']['epoch'] }}
Summary:        Module {{ module_name }} RPM generated for Device Edge blueprint {{ blueprint['name'] }}
BuildArch:      x86_64
License:        MIT
%undefine _disable_source_fetch

%description
This RPM is automatically generated by the 'edge_compose_blueprint' Ansible role to be included in a Device Edge image

{# Include the RPM spec snippet from the module if present #}
{% if module_has_spec_snippet['stat']['exists'] %}
{{ lookup('file', edge_compose_blueprint_checkout + '/modules/' + module_name + '/' + module_name + '.specsnip') }}
{% endif %}

%files
{% for file in module_rpm_files['files'] | default([]) %}
{{ file['path'] | regex_replace('/tmp/compose_' + blueprint['name'] + '/rpm/BUILDROOT/' + blueprint['name'] + '-' + module_name + '-1.0-' + ansible_facts['date_time']['epoch'] + '.x86_64', '') }}
{% endfor %}

%changelog
* Mon Jan 01 2024 Ansible <ansible@example.nl>
- Autogenerated RPM package
